using System;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using JetBrains.Annotations;
using Nuke.Common.IO;

public class SourceFileHeader(string licenseText, string autoGeneratedText)
{
    public static SourceFileHeader FromFile(AbsolutePath licenseText, AbsolutePath autogeneratedText) => new(licenseText.ReadAllText(), autogeneratedText.ReadAllText());
    readonly CommentTemplate CMultiBlockCommentTemplate = new("/*", $"*/", " * ", emptyLine: "<p/>");
    readonly CommentTemplate YamlTemplate = new(null, null, "# ");
    public string Apply([CanBeNull] string source, DocumentType documentType, bool isAutoGenerated = false)
    {
        var template = documentType switch
        {
            DocumentType.CSharp or DocumentType.Java => CMultiBlockCommentTemplate,
            DocumentType.Yaml => YamlTemplate,
        };
        var sb = new StringBuilder();
        sb.AppendLine(template.Apply(licenseText.Trim()));
        if (isAutoGenerated)
        {
            sb.AppendLine(template.Apply(autoGeneratedText.Trim()));
        }

        if (source != null)
        {
            sb.AppendLine(source);
        }

        return sb.ToString();
    }

    readonly struct CommentTemplate(string blockPrefix, string blockSuffix, string linePrefix, string emptyLine = null)
    {
        public string Apply(string source)
        {
            var lines = source.Split("\n").Select(x => x.Trim());
            var sb = new StringBuilder();
            if(blockPrefix != null)
                sb.AppendLine(blockPrefix);
            foreach (var line in lines)
            {
                var currentLine = line;
                if (string.IsNullOrWhiteSpace(line))
                    currentLine = emptyLine;
                sb.AppendLine($"{linePrefix}{currentLine}");
            }
            if(blockSuffix != null)
                sb.AppendLine(blockSuffix);
            return sb.ToString();
        }
    }
    public enum DocumentType
    {
        CSharp,
        Java,
        Yaml
    }
}


